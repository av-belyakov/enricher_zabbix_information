# План работы:

## Файл конфигурации

Добавить в конфигурационный файл параметры времени, на основании которых будет выполнятся запуск обработчиков:

- параметр 'запуск через определённый интервал времени'.
  _Придумать название параметра и меру времени, наверное в сек_.

- параметр 'запуск в определённое время'.
  _Придумать название параметра и выбрать формат даты, например RFC3339_.

**Вопрос** нужно ли использовать оба параметра одновременно или они в настройках должны быть взаимоисключающими?

## Общая логика приложения

Порядок инициализации модулей может отличатся от перечисленного ниже.

1. [x] Проверка наличия основной переменной окружения **GO_ENRICHERZI_MAIN**.
2. [x] Инициализация модуля чтения конфигурационного файла.
3. [x] Инициализация модуля-пакета логирования.
4. [x] Инициализация модуля взаимодействия с БД для передачи логов.
5. [x] Инициализация модуля чтения словарей (файл _dictionary_ в директории _config_).
6. [x] Инициализация модуля-обертки логирования данных. Получает логи через, сформированный этим модулем, канал и передаёт логи модулю-пакету логирования.
7. [ ] Тестовая проверка доступности Zabbix.
8. [ ] Запуск цикла, прослушивающего канал временного интервала или сигнала по рассписанию (например внедрить рассписание) для запуска основного обработчика.
       Пример:

- для временного интервала

```go
c := time.Tick(5 \* time.Second)
```

- по рассписанию, можно использовать **gocron**

```bash
go get github.com/go-co-op/gocron/v2
```

9. [x] Вывод информационного сообщения.

10. [ ] Выполнить запрос к Zabbix, что бы получить список хостов, по которым будет выполнятся работа. Список хостов запрашиватеся на основании списка групп хостов, которые были получены ранее при чтении файла _dictionary_. В информации о хосте, в разделе 'макросы' будет доменное имя которое нужно будет преобразовать в ip адрес.

11. [ ] Поместить полученный список хостов в конкурентно безопасное хранилище. Вся дальнейшая работа далее будет выполнятся с данным хранилищем.

12. [ ] Выполнить поиск в хранилище хостов которые ещё не были обработаны и которые **НЕ СОДЕРЖАТ** или наобород **СОДЕРЖАТ** какое то значение макроса

13. [ ] Доменное имя хостов, подходящих по условию, отправить для обогащения в виде запроса к DNS серверу. Нужно будет использовать штатные средства Go для DNS запросов. Количество workers для таких запросов ограничить определенным числом.

14. [ ] После получения ответа от DNS сервера, выполняется запрос к NetBox для проверки ip адреса на вхождение его в определённый сетевой диапазон. Если ip адрес входит в определённый сетевой диапазон, то нужно добавить в Zabbix, для данного хоста, тег формата Name :'СОА', Value:'id СОА'.

15. [ ] Думаю, что после обработки списка хостов, временное хранилище нужно очистить, что бы не засорять память. Значит надо предусмотреть очистку хранилища.
